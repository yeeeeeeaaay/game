<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–®–∞—à–∫–∏ —Å –∫–∞–ø–∏–±–∞—Ä–æ–π ü¶´</title>

<style>
body{
  margin:0;
  font-family: Comic Sans MS, Arial, sans-serif;
  background: linear-gradient(135deg,#fff7e6,#ffd966);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  min-height:100vh;
}

h2{color:#6b4f4f;margin:10px;}

#capy{
  width:140px;
}

#board{
  display:grid;
  grid-template-columns:repeat(8,60px);
  grid-template-rows:repeat(8,60px);
  border:5px solid #6b4f4f;
  margin-top:15px;
}

.cell{
  width:60px;
  height:60px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.cell.dark{background:#6b4f4f;}
.cell.light{background:#f6e8d5;}

.piece{
  width:46px;
  height:46px;
  border-radius:50%;
  cursor:pointer;
}

.player{background:white;}
.bot{background:black;}

.selected{
  outline:4px solid yellow;
}

/* —ç–∫—Ä–∞–Ω –∫–æ–Ω—Ü–∞ */
#endScreen{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  color:white;
  font-size:30px;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:9999;
}
</style>
</head>

<body>

<h2>–®–∞—à–∫–∏ —Å –∫–∞–ø–∏–±–∞—Ä–æ–π</h2>
<img id="capy" src="https://png.pngtree.com/png-clipart/20240709/original/pngtree-cartoon-capybara-with-blue-suit-vector-png-image_15523170.png">

<div id="board"></div>

<div id="endScreen">
  <div id="endText"></div>
  <img src="https://png.pngtree.com/png-clipart/20240709/original/pngtree-cartoon-capybara-with-blue-suit-vector-png-image_15523170.png" width="180">
</div>

<audio id="eatSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_3c3a4d8d6e.mp3"></audio>

<script>
const SIZE=8;
const board=document.getElementById("board");
let cells=[];
let pieces=[];
let selected=null;
let playerTurn=true;

// ---------- –°–û–ó–î–ê–ù–ò–ï –î–û–°–ö–ò ----------
for(let r=0;r<SIZE;r++){
  cells[r]=[];
  pieces[r]=[];
  for(let c=0;c<SIZE;c++){
    const cell=document.createElement("div");
    cell.className="cell "+((r+c)%2?"dark":"light");
    board.appendChild(cell);
    cells[r][c]=cell;
    pieces[r][c]=null;

    if((r+c)%2 && r<3){
      addPiece(r,c,"bot");
    }
    if((r+c)%2 && r>4){
      addPiece(r,c,"player");
    }
  }
}

// ---------- –§–£–ù–ö–¶–ò–ò ----------
function addPiece(r,c,type){
  const p=document.createElement("div");
  p.className="piece "+type;
  p.dataset.type=type;
  cells[r][c].appendChild(p);
  pieces[r][c]=p;

  if(type==="player"){
    p.onclick=()=>selectPiece(p);
  }
}

function selectPiece(p){
  if(!playerTurn) return;
  if(selected) selected.classList.remove("selected");
  selected=p;
  selected.classList.add("selected");
}

function findPiece(p){
  for(let r=0;r<SIZE;r++)
    for(let c=0;c<SIZE;c++)
      if(pieces[r][c]===p) return {r,c};
}

board.onclick=e=>{
  if(!selected || !playerTurn) return;
  const cell=e.target.closest(".cell");
  if(!cell) return;

  const tr=[...board.children].indexOf(cell);
  const r=Math.floor(tr/8);
  const c=tr%8;

  const {r:sr,c:sc}=findPiece(selected);
  const dr=r-sr, dc=c-sc;

  // –æ–±—ã—á–Ω—ã–π —Ö–æ–¥
  if(dr===-1 && Math.abs(dc)===1 && !pieces[r][c]){
    move(sr,sc,r,c);
    return;
  }

  // —Å—ä–µ–¥–µ–Ω–∏–µ
  if(dr===-2 && Math.abs(dc)===2){
    const mr=sr-1, mc=sc+dc/2;
    if(pieces[mr][mc]?.dataset.type==="bot" && !pieces[r][c]){
      eat(sr,sc,r,c,mr,mc);
    }
  }
};

function move(sr,sc,tr,tc){
  cells[sr][sc].removeChild(pieces[sr][sc]);
  cells[tr][tc].appendChild(pieces[sr][sc]);
  pieces[tr][tc]=pieces[sr][sc];
  pieces[sr][sc]=null;
  selected.classList.remove("selected");
  selected=null;
  playerTurn=false;
  setTimeout(botMove,400);
}

function eat(sr,sc,tr,tc,er,ec){
  pieces[er][ec].remove();
  pieces[er][ec]=null;
  document.getElementById("eatSound").play();
  move(sr,sc,tr,tc);
  checkEnd();
}

// ---------- –ë–û–¢ ----------
function botMove(){
  let moves=[];
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      if(pieces[r][c]?.dataset.type==="bot"){
        for(let dc of [-1,1]){
          // –∞—Ç–∞–∫–∞
          if(
            pieces[r+1]?.[c+dc]?.dataset.type==="player" &&
            !pieces[r+2]?.[c+2*dc]
          ){
            return botEat(r,c,r+2,c+2*dc,r+1,c+dc);
          }
          // –æ–±—ã—á–Ω—ã–π
          if(!pieces[r+1]?.[c+dc]){
            moves.push([r,c,r+1,c+dc]);
          }
        }
      }
    }
  }
  if(moves.length){
    const m=moves[Math.floor(Math.random()*moves.length)];
    move(m[0],m[1],m[2],m[3]);
  }
  playerTurn=true;
}

function botEat(sr,sc,tr,tc,er,ec){
  pieces[er][ec].remove();
  pieces[er][ec]=null;
  document.getElementById("eatSound").play();
  move(sr,sc,tr,tc);
  checkEnd();
}

// ---------- –ö–û–ù–ï–¶ –ò–ì–†–´ ----------
function checkEnd(){
  let p=0,b=0;
  for(let r=0;r<SIZE;r++)
    for(let c=0;c<SIZE;c++){
      if(pieces[r][c]?.dataset.type==="player") p++;
      if(pieces[r][c]?.dataset.type==="bot") b++;
    }

  if(b===0) showEnd("üèÜ –ü–û–ë–ï–î–ê! –ö–∞–ø–∏–±–∞—Ä–∞ –≥–æ—Ä–¥–∏—Ç—Å—è —Ç–æ–±–æ–π ü¶´");
  if(p===0) showEnd("üòà –ü–û–†–ê–ñ–ï–ù–ò–ï‚Ä¶ –ö–∞–ø–∏–±–∞—Ä–∞ –≤ —à–æ–∫–µ");
}

function showEnd(text){
  document.getElementById("endText").innerText=text;
  document.getElementById("endScreen").style.display="flex";
}
</script>
</body>
</html>
