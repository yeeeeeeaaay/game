<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö–∞–ø–∏–±–∞—Ä–∞ –∏ –ª–∞–±–∏—Ä–∏–Ω—Ç</title>
<style>
body {margin:0; font-family: 'Comic Sans MS', Arial, sans-serif; text-align:center; background:#fff8dc;}
.screen {max-width:500px; margin:20px auto; padding:20px; border-radius:20px; background:rgba(255,255,255,0.95); box-shadow:0 0 15px #ccc;}
input {font-size:18px; padding:8px; border-radius:10px; border:2px solid #333; width:60%;}
button {font-size:18px; padding:10px 20px; border:none; border-radius:12px; cursor:pointer; margin-left:10px;}
iframe {width:100%; height:280px; border:none; border-radius:12px;}
#mazeContainer {position:relative; width:400px; height:400px; background:#b2d8b2; margin:20px auto; border-radius:20px; border:10px solid #5c4033; box-sizing:border-box; touch-action:none;}
.wall {position:absolute; background:#5c4033; border-radius:5px;}
#player {position:absolute; width:50px; height:50px; background-image:url("https://png.pngtree.com/png-clipart/20240709/original/pngtree-cartoon-capybara-with-blue-suit-vector-png-image_15523170.png"); background-size:contain; background-repeat:no-repeat; left:10px; top:10px; transition:left 0.1s linear, top 0.1s linear; z-index:10;}
#goal {position:absolute; width:100px; height:35px; background-image:url("https://snickersni.kz/i/packs/dushnila.png"); background-size:contain; background-repeat:no-repeat; bottom:10px; right:10px;}
#bubblesCanvas {position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:9999;}
</style>
</head>
<body>

<!-- –°–¢–†–ê–ù–ò–¶–ê –° –í–û–ü–†–û–°–û–ú -->
<div id="questionScreen" class="screen">
  <h2>ü¶´ –¢–≤–æ—è –ª—é–±–∏–º–∫–∞?</h2>
  <img src="https://png.pngtree.com/png-clipart/20240709/original/pngtree-cartoon-capybara-with-blue-suit-vector-png-image_15523170.png" style="width:150px; height:auto; margin-bottom:10px;">
  <br>
  <input id="answerInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç" autocomplete="off"/>
  <button onclick="checkAnswer()">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
  <p>–ü–æ–∫–∞ –¥—É–º–∞–µ—à—å ‚Äî —Å–ª—É—à–∞–π –º—É–∑—ã–∫—É!</p>
  <iframe id="musicVideo" src="https://www.youtube.com/embed/kbEC-AGr9n0?start=13&autoplay=1&controls=0&rel=0&modestbranding=1&iv_load_policy=3&playsinline=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>

<!-- –õ–ê–ë–ò–†–ò–ù–¢ -->
<div id="mazeScreen" class="screen" style="display:none;">
  <h3>–ü–æ–π–º–∞–π —à–æ–∫–æ–ª–∞–¥–∫—É Snickers! üç´</h3>
  <div id="mazeContainer">
    <div id="player"></div>
    <div id="goal"></div>
  </div>
</div>

<!-- –°–û–û–ë–©–ï–ù–ò–ï –ü–û–°–õ–ï -->
<div id="messageScreen" class="screen" style="display:none;">
  <h2 id="messageText"></h2>
</div>

<canvas id="bubblesCanvas"></canvas>

<script>
const questionScreen = document.getElementById("questionScreen");
const answerInput = document.getElementById("answerInput");
const mazeScreen = document.getElementById("mazeScreen");
const mazeContainer = document.getElementById("mazeContainer");
const player = document.getElementById("player");
const goal = document.getElementById("goal");
const messageScreen = document.getElementById("messageScreen");
const messageText = document.getElementById("messageText");
const bubblesCanvas = document.getElementById("bubblesCanvas");
const ctx = bubblesCanvas.getContext("2d");
bubblesCanvas.width = window.innerWidth;
bubblesCanvas.height = window.innerHeight;

let playerPos = {left:10, top:10};
const playerSize = 50;
const walls = [];

// –õ–æ–≥–∏—á–Ω—ã–π –ø—Ä–æ—Ö–æ–¥–∏–º—ã–π –ª–∞–±–∏—Ä–∏–Ω—Ç
const wallData = [
  {left:0, top:0, width:400, height:10},    
  {left:0, top:0, width:10, height:400},    
  {left:0, top:390, width:400, height:10},  
  {left:390, top:0, width:10, height:400},  
  {left:60, top:10, width:10, height:150},
  {left:120, top:100, width:10, height:250},
  {left:180, top:0, width:10, height:300},
  {left:240, top:100, width:10, height:300},
  {left:300, top:0, width:10, height:250},
  {left:360, top:150, width:10, height:240},
];

function createWalls() {
  walls.forEach(w=> mazeContainer.removeChild(w.el));
  walls.length=0;
  wallData.forEach(w=>{
    const wall = document.createElement("div");
    wall.className="wall";
    wall.style.left=w.left+"px";
    wall.style.top=w.top+"px";
    wall.style.width=w.width+"px";
    wall.style.height=w.height+"px";
    mazeContainer.appendChild(wall);
    walls.push({...w, el:wall});
  });
}

function checkCollision(nx, ny) {
  const playerRect = {left:nx, top:ny, right:nx+playerSize, bottom:ny+player.offsetHeight};
  for(let w of walls){
    const wallRect={left:w.left, top:w.top, right:w.left+w.width, bottom:w.top+w.height};
    if(!(playerRect.right<=wallRect.left || playerRect.left>=wallRect.right || playerRect.bottom<=wallRect.top || playerRect.top>=wallRect.bottom)){
      return true;
    }
  }
  return false;
}

function checkWin(nx, ny) {
  const goalRect={left:goal.offsetLeft, top:goal.offsetTop, right:goal.offsetLeft+goal.offsetWidth, bottom:goal.offsetTop+goal.offsetHeight};
  const playerRect={left:nx, top:ny, right:nx+playerSize, bottom:ny+player.offsetHeight};
  return !(playerRect.right<goalRect.left || playerRect.left>goalRect.right || playerRect.bottom<goalRect.top || playerRect.top>goalRect.bottom);
}

function showMessage(text) {
  mazeScreen.style.display="none";
  messageScreen.style.display="block";
  messageText.innerText=text;
  createBubbles(150);
}

function createBubbles(count){
  let bubbles=[];
  for(let i=0;i<count;i++){
    bubbles.push({x:Math.random()*window.innerWidth, y:Math.random()*window.innerHeight, radius:Math.random()*10+5, speed:Math.random()*2+1, opacity:Math.random()*0.5+0.5});
  }
  function draw(){
    ctx.clearRect(0,0,window.innerWidth, window.innerHeight);
    bubbles.forEach(b=>{
      ctx.beginPath();
      ctx.arc(b.x,b.y,b.radius,0,Math.PI*2);
      ctx.fillStyle=`rgba(173,216,230,${b.opacity})`;
      ctx.fill();
      b.y -= b.speed;
      if(b.y+b.radius<0) b.y=window.innerHeight+b.radius;
    });
    requestAnimationFrame(draw);
  }
  draw();
}

function checkAnswer(){
  const ans = answerInput.value.trim().toLowerCase();
  if(ans==="–ª–∏—Å–∞"){
    alert("Chill");
    questionScreen.style.display="none";
    mazeScreen.style.display="block";
    createWalls();
  } else {
    alert("–î—É–º–∞—é, —Ç–≤–æ—è –ª—é–±–∏–º–∫–∞ —Ç–µ–±—è –Ω–µ –ø—Ä–æ—Å—Ç–∏—Ç üòÜ");
    answerInput.value="";
  }
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ü–ö
document.addEventListener("keydown", e=>{
  movePlayer(e.key);
});

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ (—Å–≤–∞–π–ø—ã)
let touchStart={x:0, y:0};
mazeContainer.addEventListener("touchstart", e=>{
  const t=e.touches[0]; touchStart={x:t.clientX, y:t.clientY};
});
mazeContainer.addEventListener("touchend", e=>{
  const t=e.changedTouches[0];
  const dx=t.clientX-touchStart.x;
  const dy=t.clientY-touchStart.y;
  if(Math.abs(dx)>Math.abs(dy)){
    movePlayer(dx>0?"ArrowRight":"ArrowLeft");
  } else {
    movePlayer(dy>0?"ArrowDown":"ArrowUp");
  }
});

function movePlayer(key){
  if(mazeScreen.style.display==="none") return;
  const step=10;
  let nx=playerPos.left;
  let ny=playerPos.top;
  if(key==="ArrowUp") ny-=step;
  else if(key==="ArrowDown") ny+=step;
  else if(key==="ArrowLeft") nx-=step;
  else if(key==="ArrowRight") nx+=step;

  if(nx<0) nx=0;
  if(ny<0) ny=0;
  if(nx>400-playerSize) nx=400-playerSize;
  if(ny>400-player.offsetHeight) ny=400-player.offsetHeight;

  if(!checkCollision(nx,ny)){
    playerPos.left=nx;
    playerPos.top=ny;
    player.style.left=nx+"px";
    player.style.top=ny+"px";

    if(checkWin(nx,ny)){
      showMessage("–ü–æ–∑–¥—Ä–∞–≤–ª—è—é, —Ç—ã –ø—Ä–æ—à—ë–ª! –° –º–µ–Ω—è 3 –∂–µ–ª–∞–Ω–∏—è, –π–µ–µ–µ–µ–µ–µ–µ–π!");
    }
  }
}
</script>
</body>
</html>
