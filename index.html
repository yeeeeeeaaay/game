<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–ö–∞–ø–∏–±–∞—Ä–∞ –∏ –ª–∞–±–∏—Ä–∏–Ω—Ç</title>
<style>
  body {
    margin: 0; background: #fff8dc; font-family: 'Comic Sans MS', Arial, sans-serif; text-align:center;
  }
  #questionScreen, #mazeContainer, #messageScreen {
    max-width: 500px; margin: 20px auto; background: rgba(255 255 255 / 0.9);
    border-radius: 20px; padding: 20px; box-shadow: 0 0 15px #ccc;
  }
  input {
    font-size: 18px; padding: 8px; border-radius: 10px; border: 2px solid #333; width: 60%;
  }
  button {
    font-size: 18px; padding: 10px 20px; border:none; border-radius:12px; cursor:pointer; margin-left:10px;
  }
  #videoWrapper {
    max-width: 500px; margin: 20px auto;
  }
  iframe {
    width: 100%; height: 280px; border:none; border-radius: 12px;
  }
  #mazeContainer {
    position: relative; width: 500px; height: 500px; background: #b2d8b2; margin-top: 20px;
    border-radius: 20px; border: 20px solid #5c4033;
    box-sizing: border-box;
  }
  .wall {
    position: absolute; background: #5c4033; border-radius: 10px;
  }
  #player {
    position: absolute; width: 50px; height: 60px;
    background-image: url("https://png.pngtree.com/png-clipart/20240709/original/pngtree-cartoon-capybara-with-blue-suit-vector-png-image_15523170.png");
    background-size: contain; background-repeat: no-repeat;
    left: 10px; top: 10px;
    transition: left 0.15s linear, top 0.15s linear;
    z-index: 10;
  }
  #goal {
    position: absolute; bottom: 10px; right: 10px; width: 100px; height: 35px;
    background-image: url("https://snickersni.kz/i/packs/dushnila.png");
    background-size: contain; background-repeat: no-repeat;
    cursor: default;
  }
  #bubblesCanvas {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;
  }
</style>
</head>
<body>

<div id="questionScreen">
  <h2>ü¶´ –í–æ–ø—Ä–æ—Å ü¶´</h2>
  <p>–¢–≤–æ—è –ª—é–±–∏–º–∫–∞?</p>
  <input id="answerInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç" autocomplete="off" />
  <button onclick="checkAnswer()">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
</div>

<div id="videoWrapper" style="display:none;">
  <iframe id="musicVideo" src="https://www.youtube.com/embed/kbEC-AGr9n0?start=13&autoplay=1&controls=0&rel=0&modestbranding=1&iv_load_policy=3&mute=0" allow="autoplay" allowfullscreen></iframe>
</div>

<div id="mazeContainer" class="hidden">
  <h3>–ü–æ–π–º–∞–π —à–æ–∫–æ–ª–∞–¥–∫—É Snickers! üç´</h3>
  <div id="player"></div>
  <div id="goal"></div>
</div>

<div id="messageScreen" class="hidden">
  <h2 id="messageText"></h2>
</div>

<canvas id="bubblesCanvas"></canvas>

<script>
  const questionScreen = document.getElementById("questionScreen");
  const answerInput = document.getElementById("answerInput");
  const videoWrapper = document.getElementById("videoWrapper");
  const mazeContainer = document.getElementById("mazeContainer");
  const player = document.getElementById("player");
  const goal = document.getElementById("goal");
  const messageScreen = document.getElementById("messageScreen");
  const messageText = document.getElementById("messageText");
  const bubblesCanvas = document.getElementById("bubblesCanvas");
  const ctx = bubblesCanvas.getContext("2d");
  bubblesCanvas.width = window.innerWidth;
  bubblesCanvas.height = window.innerHeight;

  let playerPos = {left: 10, top: 10};
  const playerSize = 50;
  const walls = [];

  // –°—Ç–µ–Ω—ã –ª–∞–±–∏—Ä–∏–Ω—Ç–∞ - –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ (px)
  // –ü—Ä–∏–º–µ—Ä: {left: x, top: y, width: w, height: h}
  const wallData = [
    {left: 0, top: 0, width: 500, height: 20},    // –í–µ—Ä—Ö–Ω—è—è
    {left: 0, top: 0, width: 20, height: 500},    // –õ–µ–≤–∞—è
    {left: 0, top: 480, width: 500, height: 20},  // –ù–∏–∂–Ω—è—è
    {left: 480, top: 0, width: 20, height: 500},  // –ü—Ä–∞–≤–∞—è
    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç–µ–Ω—ã
    {left: 60, top: 0, width: 20, height: 380},
    {left: 120, top: 120, width: 20, height: 380},
    {left: 180, top: 0, width: 20, height: 380},
    {left: 240, top: 120, width: 20, height: 380},
    {left: 300, top: 0, width: 20, height: 380},
    {left: 360, top: 120, width: 20, height: 380},
    {left: 420, top: 0, width: 20, height: 380},

    {left: 20, top: 60, width: 60, height: 20},
    {left: 80, top: 180, width: 60, height: 20},
    {left: 140, top: 60, width: 60, height: 20},
    {left: 200, top: 180, width: 60, height: 20},
    {left: 260, top: 60, width: 60, height: 20},
    {left: 320, top: 180, width: 60, height: 20},
    {left: 380, top: 60, width: 60, height: 20},
    {left: 440, top: 180, width: 40, height: 20}
  ];

  function createWalls() {
    wallData.forEach(w => {
      const wall = document.createElement("div");
      wall.className = "wall";
      wall.style.left = w.left + "px";
      wall.style.top = w.top + "px";
      wall.style.width = w.width + "px";
      wall.style.height = w.height + "px";
      mazeContainer.appendChild(wall);
      walls.push({el: wall, ...w});
    });
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π —Å –ª–∞–±–∏—Ä–∏–Ω—Ç–æ–º
  function checkCollision(nx, ny) {
    const playerRect = {left: nx, top: ny, right: nx + playerSize, bottom: ny + player.offsetHeight};
    for(let w of walls) {
      const wallRect = {
        left: w.left, top: w.top,
        right: w.left + w.width,
        bottom: w.top + w.height
      };
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤
      if (!(playerRect.right <= wallRect.left || 
            playerRect.left >= wallRect.right ||
            playerRect.bottom <= wallRect.top ||
            playerRect.top >= wallRect.bottom)) {
        return true; // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ –µ—Å—Ç—å
      }
    }
    return false; // —Å–≤–æ–±–æ–¥–Ω–æ
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–∏ (—à–æ–∫–æ–ª–∞–¥–∫–∏)
  function checkWin(nx, ny) {
    const goalRect = {
      left: goal.offsetLeft,
      top: goal.offsetTop,
      right: goal.offsetLeft + goal.offsetWidth,
      bottom: goal.offsetTop + goal.offsetHeight
    };
    const playerRect = {left: nx, top: ny, right: nx + playerSize, bottom: ny + player.offsetHeight};
    return !(playerRect.right < goalRect.left || 
             playerRect.left > goalRect.right ||
             playerRect.bottom < goalRect.top ||
             playerRect.top > goalRect.bottom);
  }

  function showMessage(text) {
    questionScreen.classList.add("hidden");
    videoWrapper.style.display = "none";
    mazeContainer.classList.add("hidden");
    messageScreen.classList.remove("hidden");
    messageText.innerText = text;
    createBubbles(100);
  }

  function createBubbles(count) {
    let bubbles = [];
    for(let i=0;i<count;i++){
      bubbles.push({
        x: Math.random()*window.innerWidth,
        y: Math.random()*window.innerHeight,
        radius: Math.random()*10+5,
        speed: Math.random()*2+1,
        opacity: Math.random()*0.5+0.5
      });
    }
    function draw() {
      ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
      bubbles.forEach(b=>{
        ctx.beginPath();
        ctx.arc(b.x,b.y,b.radius,0,Math.PI*2);
        ctx.fillStyle = `rgba(173, 216, 230, ${b.opacity})`;
        ctx.fill();
        b.y -= b.speed;
        if(b.y + b.radius < 0) b.y = window.innerHeight + b.radius;
      });
      requestAnimationFrame(draw);
    }
    draw();
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å
  function checkAnswer() {
    const ans = answerInput.value.trim().toLowerCase();
    if(ans === "–ª–∏—Å–∞") {
      questionScreen.style.display = "none";
      videoWrapper.style.display = "block";
      mazeContainer.classList.remove("hidden");
      createWalls();
      answerInput.value = "";
      alert("Chill");
    } else {
      alert("–î—É–º–∞—é, —Ç–≤–æ—è –ª—é–±–∏–º–∫–∞ —Ç–µ–±—è –Ω–µ –ø—Ä–æ—Å—Ç–∏—Ç üòÜ");
      answerInput.value = "";
    }
  }

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏–±–∞—Ä–æ–π
  document.addEventListener("keydown", e=>{
    if(mazeContainer.classList.contains("hidden")) return;

    const step = 10;
    let nx = playerPos.left;
    let ny = playerPos.top;
    if(e.key === "ArrowUp") ny -= step;
    else if(e.key === "ArrowDown") ny += step;
    else if(e.key === "ArrowLeft") nx -= step;
    else if(e.key === "ArrowRight") nx += step;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
    if(nx < 0) nx = 0;
    if(ny < 0) ny = 0;
    if(nx > 500 - playerSize) nx = 500 - playerSize;
    if(ny > 500 - player.offsetHeight) ny = 500 - player.offsetHeight;

    if(!checkCollision(nx, ny)) {
      playerPos.left = nx;
      playerPos.top = ny;
      player.style.left = nx + "px";
      player.style.top = ny + "px";

      if(checkWin(nx, ny)) {
        mazeContainer.classList.add("hidden");
        videoWrapper.style.display = "none";
        showMessage("–ü–æ–∑–¥—Ä–∞–≤–ª—è—é, —Ç—ã –ø—Ä–æ—à—ë–ª! –° –º–µ–Ω—è 3 –∂–µ–ª–∞–Ω–∏—è, –π–µ–µ–µ–µ–µ–µ–µ–π!");
      }
    }
  });
</script>

</body>
</html>
